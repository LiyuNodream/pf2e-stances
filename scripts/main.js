(()=>{"use strict";let e="";function f(...f){let[t,s]=f;return t=`${e}.${t}`,s?game.i18n.format(t,s):game.i18n.localize(t)}function t(e){return e.getFlag("core","sourceId")}const s=[{feat:"Compendium.pf2e.classfeatures.09iL38CZZEa0q0Mt",effect:"Compendium.pf2e.feat-effects.fsjO5oTKttsbpaKl"},{feat:"Compendium.pf2e.feats-srd.tDWc2LQNl0Op1Auq",effect:"Compendium.pf2e-stances.effects.PS17dsXkTdQmOv7w"},{feat:"Compendium.pf2e.feats-srd.AkV4Jyllo6nlK2Sl",effect:"Compendium.pf2e.feat-effects.CgxYa0lrLUjS2ZhI"},{feat:"Compendium.pf2e.feats-srd.xQuNswWB3eg1UM28",effect:"Compendium.pf2e.feat-effects.2Qpt0CHuOMeL48rN",replace:"Compendium.pf2e.feats-srd.AkV4Jyllo6nlK2Sl"},{feat:"Compendium.pf2e.feats-srd.bf7NCeKqDClaqhTR",effect:"Compendium.pf2e.feat-effects.nwkYZs6YwXYAJ4ps"},{feat:"Compendium.pf2e.feats-srd.1p5ErCp33nGOzEsk",effect:"Compendium.pf2e.feat-effects.LxSev4GNKv26DbZw"},{feat:"Compendium.pf2e.feats-srd.OEGhbRgW6wRbccns",effect:"Compendium.pf2e-stances.effects.qBR3kqGCeKp3T2Be"},{feat:"Compendium.pf2e.feats-srd.8sy3sHwOHS4ImwvJ",effect:"Compendium.pf2e.feat-effects.qUowHpn79Dpt1hVn"},{feat:"Compendium.pf2e.feats-srd.R7c4PyTNkZb0yvoT",effect:"Compendium.pf2e.feat-effects.KBEJVRrie2JTHWIK"},{feat:"Compendium.pf2e.feats-srd.FYz5eQeTox9IDkSd",effect:"Compendium.pf2e.feat-effects.KiuBRoMFxL2Npt51"},{feat:"Compendium.pf2e.feats-srd.9VGmE7X4aK2W8YWj",effect:"Compendium.pf2e.feat-effects.KiuBRoMFxL2Npt51"},{feat:"Compendium.pf2e.feats-srd.6GN1zh3RcnZhrzxP",effect:"Compendium.pf2e.feat-effects.GGebXpRPyONZB3eS"},{feat:"Compendium.pf2e.feats-srd.80CEAB05TP5ki9iW",effect:"Compendium.pf2e-stances.effects.GvqB4M8LrHpzYEvl"},{feat:"Compendium.pf2e.feats-srd.DqD7htz8Sd1dh3BT",effect:"Compendium.pf2e.feat-effects.RozqjLocahvQWERr"},{feat:"Compendium.pf2e.feats-srd.nRjyyDulHnP5OewA",effect:"Compendium.pf2e.feat-effects.UZKIKLuwpQu47feK",replace:"Compendium.pf2e.feats-srd.DqD7htz8Sd1dh3BT"},{feat:"Compendium.pf2e.feats-srd.rFaUJtB46scuAidY",effect:"Compendium.pf2e-stances.effects.mark4VEQoynfYNBF"},{feat:"Compendium.pf2e.feats-srd.YeyOqNFKaeuOTiJr",effect:"Compendium.pf2e-stances.effects.zzC2qZwEKf4Ja3xD"},{feat:"Compendium.pf2e.feats-srd.bvOsJNeI0ewvQsFa",effect:"Compendium.pf2e.feat-effects.kzEPq4aczYb6OD2h"},{feat:"Compendium.pf2e.feats-srd.x9cYkB8DrUBBwqJd",effect:"Compendium.pf2e.feat-effects.tPKXLtDJ3bzJcXlv"},{feat:"Compendium.pf2e.feats-srd.Jwq5o13uZF3ooln1",effect:"Compendium.pf2e.feat-effects.pkcr9w5x6bKzl3om"},{feat:"Compendium.pf2e.feats-srd.ZghzLmYgeE19GqjP",effect:"Compendium.pf2e-stances.effects.W8CKuADdbODpBh6O"},{feat:"Compendium.pf2e.feats-srd.KMVXUgFArcftg1jQ",effect:"Compendium.pf2e.feat-effects.6IsZQpwRJQWIzdGx"},{feat:"Compendium.pf2e.feats-srd.rByA8NDI6ZtNgBeT",effect:"Compendium.pf2e-stances.effects.NWOmJ6WJFheaGhho"},{feat:"Compendium.pf2e.feats-srd.YG2RxXE9SMfwo6wP",effect:"Compendium.pf2e.feat-effects.1dxD3xsTzak6GNj5"},{feat:"Compendium.pf2e.feats-srd.ZL5UU9quCTvcWzfY",effect:"Compendium.pf2e.feat-effects.gYpy9XBPScIlY93p"},{feat:"Compendium.pf2e.feats-srd.RzhnxgiAopWILCvs",effect:"Compendium.pf2e.feat-effects.l4QUaedYofnfXig0"},{feat:"Compendium.pf2e.feats-srd.hPDerDCYmag3s0dP",effect:"Compendium.pf2e.feat-effects.6EDoy3OSFZ4L3Vs7"},{feat:"Compendium.pf2e.feats-srd.C3MgEkPNaIhTddbr",effect:"Compendium.pf2e.feat-effects.vjvcccAwdkOLA1Fc"},{feat:"Compendium.pf2e.feats-srd.Yl2wYv24v5kw95aS",effect:"Compendium.pf2e.feat-effects.9HPxAKpP3WJmICBx"},{feat:"Compendium.pf2e.feats-srd.Ziky4XVV7syXVbUg",effect:"Compendium.pf2e-stances.effects.kDTiRg9vVOYNnTyr"},{feat:"Compendium.pf2e.feats-srd.BtZJJClWCpc31Ven",effect:"Compendium.pf2e.feat-effects.OeZ0E1oUKyGPxPy0"},{feat:"Compendium.pf2e.feats-srd.rbiMK71SvGZGRLJ1",effect:"Compendium.pf2e.feat-effects.Im5JBInybWFbHEYS"},{feat:"Compendium.pf2e.feats-srd.knZUN4sYExIyRC4F",effect:"Compendium.pf2e.feat-effects.QDQwHxNowRwzUx9R"},{feat:"Compendium.pf2e.feats-srd.tRHjUCl0xqG97nok",effect:"Compendium.pf2e-stances.effects.Unfl4QQURWaX2zfd"},{feat:"Compendium.pf2e.feats-srd.RsNvCSrCN7czHC0G",effect:"Compendium.pf2e-stances.effects.Unfl4QQURWaX2zfd"},{feat:"Compendium.pf2e.feats-srd.O0POcPD2aELYTcIK",effect:"Compendium.pf2e-stances.effects.YkiTA74FrUUu5IvI"},{feat:"Compendium.pf2e.feats-srd.6cQSPqXoAO6oJl0i",effect:"Compendium.pf2e.feat-effects.RXbfq6oqzVnW6xOV"},{feat:"Compendium.pf2e.feats-srd.hT0pVPqFuiEsmRb8",effect:"Compendium.pf2e.feat-effects.P80mwvCAEncR2snK"},{feat:"Compendium.pf2e.feats-srd.UjEeHamC2C8JfgJz",effect:"Compendium.pf2e.feat-effects.CQfkyJkRHw4IHWhv"},{feat:"Compendium.pf2e.feats-srd.GuEdTz1VMEptQnOd",effect:"Compendium.pf2e.feat-effects.rp1YauUSULuqW8rs"},{feat:"Compendium.pf2e.feats-srd.7FRYyKXDKjGoANYj",effect:"Compendium.pf2e.feat-effects.BCyGDKcplkJiSAKJ"},{feat:"Compendium.pf2e.feats-srd.2tUdsoPEnW9yS8so",effect:"Compendium.pf2e.feat-effects.PMHwCrnh9W4sMu5b"},{feat:"Compendium.pf2e.feats-srd.VCjAlOvjNvFJOsG5",effect:"Compendium.pf2e.feat-effects.pf9yvKNg6jZLrE30"},{feat:"Compendium.pf2e.feats-srd.xjLbabfyQzBNT4y1",effect:"Compendium.pf2e-stances.effects.3eHMqVx30JGiJqtM"},{feat:"Compendium.pf2e.feats-srd.kTRGAST9J9ZxJZ4A",effect:"Compendium.pf2e-stances.effects.3eHMqVx30JGiJqtM"},{feat:"Compendium.pf2e.feats-srd.Tj79ePSD212EZjRM",effect:"Compendium.pf2e.feat-effects.h45sUZFs5jhuQdCE"},{feat:"Compendium.pf2e.feats-srd.IaiEZaA8erufMUCr",effect:"Compendium.pf2e.feat-effects.JefXqvhzUeBArkAP"},{feat:"Compendium.pf2e.feats-srd.wZZyasfIqwiJBQAQ",effect:"Compendium.pf2e-stances.effects.q6UokHWSEcEYWmvh"},{feat:"Compendium.pf2e.feats-srd.AN9jY1JVcU20Qdw6",effect:"Compendium.pf2e.feat-effects.b2kWJuCPj1rDMdwz"}],n=new Map(s.map((e=>[e.feat,e]))),a=new Map(s.map((e=>[e.effect,e])));function p(e){const f=[];for(const s of e.itemTypes.effect){const e=t(s);e&&a.has(e)&&f.push({uuid:e,id:s.id})}return f}function m(e){for(const f of Object.values(ui.windows))f instanceof ActorSheet&&e===f.actor&&f.render()}function c(e){const f=o(e);if(!f)return;const t=p(f).map((e=>e.id));t.length?f.deleteEmbeddedDocuments("Item",t):m(f)}function o(e){const f=e.actor;return f&&!f.isToken&&f.isOfType("character")?f:void 0}e||(e="pf2e-stances"),Hooks.on("deleteCombatant",c),Hooks.on("createCombatant",(function(e){const f=o(e);f&&m(f)})),Hooks.on("deleteCombat",(function(e){for(const f of e.combatants)c(f)})),Hooks.on("renderCharacterSheetPF2e",(async function(s,m){const c=s.actor;await async function(s,p){const m=function(e){const f=[],s=[],p=new Map;for(const a of e.itemTypes.feat){const e=t(a),p=e&&n.get(e);p&&(f.push(p),p.replace&&s.push(p.replace))}for(const f of e.itemTypes.effect){const e=t(f);e&&a.has(e)&&p.set(e,f.id)}return f.filter((e=>!s.includes(e.feat))).map((e=>{const f=fromUuidSync(e.feat),t=fromUuidSync(e.effect),s=e.replace&&fromUuidSync(e.replace);if(f&&t)return{name:s?s.name:f.name,img:t.img,effectID:p.get(e.effect)??"",effectUUID:e.effect}})).filter((e=>e))}(s).sort(((e,f)=>e.name.localeCompare(f.name)));if(!m.length)return;const c=s.getActiveTokens(!0,!0).some((e=>e.inCombat)),o=p.find(".sheet-body .sheet-content [data-tab=actions] .tab-content .actions-panels [data-tab=encounter] .actions-options"),d=await renderTemplate(function(...f){return f=f.filter((e=>"string"==typeof e)),`modules/${e}/templates/${f.join("/")}`}("stances.hbs"),{stances:m,canUseStances:c&&!s.isDead,i18n:f});o.after(d)}(c,m),m.find(".sheet-body .sheet-content [data-tab=actions] .tab-content .actions-panels [data-tab=encounter] .pf2e-stances .pf2e-stances__stance").on("click",(e=>async function(e,f){const t=e.currentTarget,s=t.closest(".pf2e-stances")?.classList.contains("can-use-stances");if(!e.ctrlKey&&!s)return;const n=t.dataset.effectUuid,a=p(f),m=a.findIndex((e=>e.uuid===n));let c=!1;if(m<0)c=!0;else if(a.length){const e=a.filter((e=>e.uuid!==n)).length,f=a.filter((e=>e.uuid===n)).length>1;(e||f)&&a.splice(m,1)}if(a.length&&await f.deleteEmbeddedDocuments("Item",a.map((e=>e.id))),c){const e=await fromUuid(n);if(e){const t=await f.createEmbeddedDocuments("Item",[e.toObject()]);t[0]?.toMessage()}}}(e,c)))}))})();
//# sourceMappingURL=main.js.map